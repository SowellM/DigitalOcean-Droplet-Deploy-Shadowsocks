name: Deploy Shadowsocks

on:
  workflow_dispatch:
    inputs:
      domain:
        description: "Base domain (example.com)"
        required: true
      subdomain:
        description: "Subdomain (e.g. ss)"
        required: true
      email:
        description: "Email for Let's Encrypt"
        required: true
      password:
        description: "Shadowsocks password"
        required: true
      mode:
        description: "tls or tcp-udp"
        required: false
        default: "tls"
      digitalocean_access_token:
        description: "DigitalOcean API token"
        required: true
      digitalocean_ssh_key:
        description: "SSH key ID(s) registered in DigitalOcean"
        required: true
      region:
        description: "DigitalOcean region (e.g., nyc1, sfo3, ams3)"
        required: false
        default: "sfo3"
      size:
        description: "Droplet size slug (e.g., s-1vcpu-512mb-10gb)"
        required: false
        default: "s-1vcpu-512mb-10gb"
      image:
        description: "Droplet image slug (e.g., ubuntu-22-04-x64)"
        required: false
        default: "ubuntu-22-04-x64"
      hostname:
        description: "Droplet hostname"
        required: false
        default: "ss"


jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Run local Shadowsocks Action
        uses: ./
        with:
          domain: ${{ github.event.inputs.domain }}
          subdomain: ${{ github.event.inputs.subdomain }}
          email: ${{ github.event.inputs.email }}
          password: ${{ github.event.inputs.password }}
          mode: ${{ github.event.inputs.mode }}
          digitalocean_access_token: ${{ secrets.DIGITALOCEAN_ACCESS_TOKEN }}
          digitalocean_ssh_key: ${{ secrets.DIGITALOCEAN_SSH_KEY }}
          region: ${{ github.event.inputs.region }}
          size: ${{ github.event.inputs.size }}
          image: ${{ github.event.inputs.image }}
          hostname: ${{ github.event.inputs.hostname }}
